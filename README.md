# 클린 아키텍처(헥사고날 아키텍처) 예제 구현

- [우아한 기술 블로그 'Spring Boot Kotlin Multi Module로 구성해보는 헥사고날 아키텍처'](https://techblog.woowahan.com/12720/) 를 참고하였음
- 위 포스팅에서는 모듈을 Bootstrap Hexagon, Application Hexagon, Domain Hexagon, Framework Hexagon 으로 구분하고 있지만
  이 레포지토리의 예제에서는 api, application, domain, infrastructure 으로 모듈을 구분하고 있음(역할은 동일하고 명칭만 다름)
- 위 포스팅에 각 모듈의 패키지 구조가 나와있는데, 이 레포지토리의 예제에서는 패키지 구조를 포스팅과 다르게 구성하고 있음
  [만들면서 배우는 클린 아키텍처](https://www.yes24.com/Product/Goods/105138479?pid=123487&cosemkid=go16373101893711165) 를 주로 참고함

## 각 모듈 역할 설명

### api
- 

### application
- port(in, out) 를 구현한 모듈
- 시스템이 가지는 기능/사례(usecase)를 선언 및 구현
- 유일하게 domain 에 대해서만 의존성을 가진다. domain 이 제일 중심부에 위치하고 이를 감싸는 모듈로 의존성이 계속 안쪽으로 향한다는 것을 인지하자.
```groovy
dependencies {
    implementation project(':saving-domain')
    implementation 'org.springframework:spring-context:6.0.12'
}
```
- 엄격하게 application 도 기술에 침투당하지 않아야 하는데 위 우아한 형제들 포스팅에서도 그렇고 '만들면서 배우는 클린 아키텍처'에서도 그렇고
  스프링을 사용한다고 가정하고 usecase의 구현체를 Bean 으로 선언하고 사용한다.
- 이걸 굳이 엄격하게 기술에서 자유롭게 분리하려면 커스텀한 어노테이션을 따로 설정하든가 하고 바깥에서 이 어노테이션을 탐지해서 Bean 으로 등록하게 하든가 해야할 것 같다.(Spring 을 쓴다면)
- 그 외 jvm 프레임워크를 쓴다면 거기에 맞게 구현해야한다. 어떤 식으로든 리플렉션이 사용 될 것이다.
- 결국 근본적인 질문을 해보자. '스프링 말고 딴 거 쓸 가능성이 0.1% 라도 있는가?' 만약 이 질문에 대해서 가능성이 0라고 말하게 된다면 스프링에 의존하는 타협을 해도 괜찮다고 본다. 
  사실 application 이 원칙적으로 기술에 침투 당하지 않는게 맞지만 이것의 근본 목적은 결국 기술 선택의 자유도를 보장하는 것인데 어차피 무조건 스프링 쓸 것이면 이런 타협은 괜찮다고 생각한다.
- 처음에 좀 헷갈렸던 부분인데 port 가 out 이라고 해서 데이터의 흐름의 방향이 무조건 아웃은 아니다. 이건 web -> 시스템 -> infrastructure 의 방향이 out 이니까 out 이라 간주된다.
  실제로 out port 를 통해서 데이터는 시스템으로 로드되기도 한다. 방향만 보면 이건 in 인데 out 이라고 분류하고 있어서 좀 헷갈렸다.
- 헥사고날 아키텍처를 '소리치는 아키텍처'로 말할 수 있는 가장 큰 이유 중 하나가 usecase 가 아닐까 싶다. 레이어드 아키텍처에서는 뚱뚱한(책에서 표현으로는 '넓은') 서비스 로직을 일일이
  봐야 어떤 기능들이 있는지 알 수 있는데, 헥사고날 아키텍처에서는 그냥 패키지 구조만 봐도 어떤 기능들을 수행할 수 있는지 usecase 들을 보면 알 수 있다.
- 나는 일부러 port 들을 CQRS 를 적용해서 어떤 usecase 가 조회성이고 데이터를 변경시키는지도 알 수 있도록 패키지를 구분했다.

### domain
- 핵심 도메인 로직을 담당하는 모듈
- 완전한 POJO 로 이루어져 있음
- 위 포스팅에서는 어떠한 의존성도 설정하지 않는다고 하지만, 나는 테스트를 위해서 예제 코드에서는 아래와 같이 일부 의존성을 설정함
  (위 포스팅에서는 아무런 의존성 없이 테스트 코드를 어떻게 작성했다는 것인지 모르겠음)
```groovy
dependencies {
    testImplementation 'org.junit.jupiter:junit-jupiter:5.9.2'
    testImplementation 'org.assertj:assertj-core:3.24.2'
}
```
- 유스케이스도 모르고, 기술과 관련(프레임워크 종류, 데이터 베이스 종류 등)해서도 아는 것이 하나도 없는 모듈(알아서도 안되고 알 필요도 없다)
- 이 모듈은 다른 모듈에 의존하지 않음. domain 은 클린아키텍처 구조상 가장 중심(내핵)에 위치한다. domain 은 외부로 어떠한 의존도 없이 독립적으로 존재해야 한다.
- 의존이 없으니 일단 domain 모듈을 제일 먼저 생성해서 구현할 수 있다. 데이터 베이스 뭘 쓸지, 인증은 어떻게 할지, 통신은 어떻게 할지 등 그러한 고민 없이 일단 핵심적인 도메인 규칙을 구현할 수 있다.

### infrastructure
-

### 질문 사항

- [ ] 배민 기술 블로그에 보면 domain 에 종속성 하나도 없는데 테스트 하기 위한 종속성이 없어서 테스트가 안된다. 어떻게 하지?
